<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <link media="screen" rel="stylesheet" href="/styles.css">
  <script type="module" src="/runtime.js"></script>
  <title>Restroom Place</title>
  <style media="screen">
    header>div {
      display: flex;
      align-items: center;
    }

    header>div>p {
      flex: 1;
      text-align: left;
      font-style: italic;
    }

    header .profile-picture {
      margin-right: 8px;
    }

    main {
      flex: 1;
      width: 100%;
      margin: 16px 0;
    }

    article.placeholder {
      font-size: 14px;
    }

    aside button {
      font-size: 16px;
    }
  </style>
</head>

<body class="center-flex">
  <header>
    <h1><em>Velice dlouhej název místa, může být ale kratší</em></h1>
    <div>
      <img class="profile-picture" src="/profile.jpg" alt="Profile picture" height="100">
      <p>
        A opět velice dlouhý popis místa a jeho okolí, aby lidi měli jistotu že tato virtuální místnost patří k
        reálnému místu kde je umístěna QR nálepka.
      </p>
    </div>
  </header>
  <main>
    <article class="placeholder">
      <em>Tato zeď je zatím čistá.</em>
    </article>
    <!-- <article>
      <p>Jo, dobře se tu kadí, ale občas to tu pěkně smrdí!</p>
    </article>
    <article>
      <p>Nevíte co bude dnes k obědu?</p>
    </article>
    <article>
      <p>Nice, mají tu i osvěžovač.</p>
    </article>
    <article>
      <p>Kdo zase nepoyžil štětku?! --václav</p>
    </article> -->
  </main>
  <aside>
    <form method="POST" id="post" class="hidden" aria-hidden="true">
      <label>
        <span>Komentář:</span>
        <textarea>Já si nic nemyslim!</textarea>
      </label>
      <button type="submit">Odeslat</button>
    </form>
  </aside>
  <script type="module">
    import { parseRoomIdFromUrl } from "/library.js";
    import { getDocData } from "/firestore.js"

    const roomId = parseRoomIdFromUrl();
    const profile = await getDocData(`rooms/${roomId}/public/profile`).catch(console.error) || {};
    profile.initialized = true;
    if (profile.initialized) {
      const postForm = document.querySelector("#post");
      postForm.classList.remove("hidden");
      postForm.setAttribute('aria-hidden', false);
    }

    if (profile.name) {
      document.querySelector("header h1").innerText = profile.name;
    }

    if (profile.bio) {
      document.querySelector("header p").innerText = profile.bio;
    }

    document.querySelector('body header').addEventListener("click", () => {
      if (profile.initialized) {
        window.location.href = `/room/${roomId}/edit`;
      }
    })
  </script>
</body>

</html>